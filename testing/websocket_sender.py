import asyncio
import numpy as np
from scipy.signal import chirp
import signal
import struct
import sys
from time import sleep, time
import websockets

URI = "ws://172.20.10.5:8081"
CAMERA_URI = URI + "/camera"
ARM_URI = URI + "/arm"
DRIVE_URI = URI + "/drive"
MOVE_URI = URI + "/move"

PAN_MIN = 0.375
PAN_MAX = 2.967
PAN_CENTER = 1.671
PAN_CENTER = ((PAN_MAX - PAN_MIN) / 2) + PAN_MIN
TILT_MIN = 1.131
TILT_MAX = 2.269
TILT_CENTER = ((TILT_MAX - TILT_MIN) / 2) + TILT_MIN

running = True


def map_value_to_range(value, source_min, source_max, target_min, target_max):
    """
    Maps a value from one numerical range to another.

    Args:
        value (float or int): The value to be mapped.
        source_min (float or int): The minimum value of the source range.
        source_max (float or int): The maximum value of the source range.
        target_min (float or int): The minimum value of the target range.
        target_max (float or int): The maximum value of the target range.

    Returns:
        float: The mapped value within the target range.
    """

    # Calculate the normalized position of the value within the source range (0 to 1)
    source_span = source_max - source_min
    if source_span == 0:  # Avoid division by zero if source range is a single point
        return target_min  # Or handle as an error, depending on desired behavior

    value_scaled = float(value - source_min) / source_span

    # Map the scaled value to the target range
    target_span = target_max - target_min
    mapped_value = target_min + (value_scaled * target_span)

    return mapped_value


async def camera():
    async with websockets.connect(CAMERA_URI) as websocket:
        await websocket.send(struct.pack("<dd", PAN_CENTER, TILT_CENTER))


async def arm():
    async with websockets.connect(ARM_URI) as websocket:
        await websocket.send(struct.pack("<?", True))


async def disarm():
    async with websockets.connect(ARM_URI) as websocket:
        await websocket.send(struct.pack("<?", False))


async def drive(speed):
    async with websockets.connect(DRIVE_URI) as websocket:
        await websocket.send(struct.pack("<dd", speed, 0))


async def frequency_response():
    """
    Given a frequency response, how can you find PID values that meet the minimum targets for phase and gain margins?

    Frequency response generated with the following parameters:
        fs = 25
        t_end = 40
        t = np.linspace(0, t_end, int(fs * t_end), endpoint=False)
        x = chirp(t, f0=0.1, f1=1, t1=t_end, method="linear")
    This system is a brushed DC motor driven by PWM. The output from the chirp function is the duty cycle (hence a sine wave with an amplitude of 1).
    The recorded data shows the speed of the motor in rad/s at a given time.

    How can this data be used to generate a frequency response and select PID gains will maximize phase and gain margin at a crossover frequency of ~1 Hz?
    """
    global running
    async with websockets.connect(DRIVE_URI) as websocket:
        fs = 25
        t_end = 40
        t = np.linspace(0, t_end, int(fs * t_end), endpoint=False)
        x = chirp(t, f0=0.1, f1=1, t1=t_end, method="linear")
        # x = 1.0 * np.sin(2 * np.pi * 0.01 * t)
        t0 = time()
        i = 0
        while i < len(t) and running:
            if time() >= t0 + t[i]:
                await websocket.send(struct.pack("<dd", x[i], 0))
                # print(time(), x[i])
                i += 1
        await websocket.send(struct.pack("<dd", 0, 0))


async def test(pwm=False):
    global running
    # duration_speed = [
    #     (3, 4),
    #     (2, 8),
    #     (1, 10),
    #     (2, 12),
    #     (0.5, 11.5),
    #     (0.5, 11),
    #     (0.5, 10.5),
    #     (0.5, 10),
    #     (0.5, 9.5),
    #     (0.5, 9),
    #     (0.5, 8.5),
    #     (0.5, 8),
    #     (0.5, 7.5),
    #     (3, 7),
    # ]

    # Stable at 20Hz
    # duration_speed = [
    #     (0.05, 0.33),
    #     (0.05, 0.66),
    #     (0.05, 0.8),
    #     (0.05, 0.95),
    #     (0.05, 0.9),
    #     (0.05, 0.85),
    #     (0.05, 0.83),
    #     (0.05, 0.8),
    #     (0.05, 0.73),
    #     (0.05, 0.71),
    #     (0.05, 0.69),
    #     (0.05, 0.66),
    #     (0.05, 0.6),
    #     (0.05, 0.55),
    # ]

    duration_speed = [
        (0.01, 0),
        (0.01, 0.03),
        (0.01, 0.043817805),
        (0.01, 0.046908783),
        (0.01, 0.050006501),
        (0.01, 0.053110185),
        (0.01, 0.056219187),
        (0.01, 0.059332957),
        (0.01, 0.062451026),
        (0.01, 0.065572992),
        (0.01, 0.068698504),
        (0.01, 0.071827257),
        (0.01, 0.074958984),
        (0.01, 0.078093449),
        (0.01, 0.081230443),
        (0.01, 0.084369779),
        (0.01, 0.087511292),
        (0.01, 0.090654832),
        (0.01, 0.093800264),
        (0.01, 0.096947466),
        (0.01, 0.100096328),
        (0.01, 0.10324675),
        (0.01, 0.10639864),
        (0.01, 0.109551914),
        (0.01, 0.112706496),
        (0.01, 0.115862314),
        (0.01, 0.119019303),
        (0.01, 0.122177404),
        (0.01, 0.125336561),
        (0.01, 0.128496722),
        (0.01, 0.131657839),
        (0.01, 0.134819867),
        (0.01, 0.137982766),
        (0.01, 0.141146497),
        (0.01, 0.144311022),
        (0.01, 0.147476309),
        (0.01, 0.150642325),
        (0.01, 0.15380904),
        (0.01, 0.156976427),
        (0.01, 0.160144459),
        (0.01, 0.163313111),
        (0.01, 0.16648236),
        (0.01, 0.169652184),
        (0.01, 0.17282256),
        (0.01, 0.175993471),
        (0.01, 0.179164896),
        (0.01, 0.182336818),
        (0.01, 0.185509221),
        (0.01, 0.188682087),
        (0.01, 0.191855402),
        (0.01, 0.195029151),
        (0.01, 0.198203321),
        (0.01, 0.201377898),
        (0.01, 0.204552869),
        (0.01, 0.207728223),
        (0.01, 0.210903948),
        (0.01, 0.214080033),
        (0.01, 0.217256468),
        (0.01, 0.220433242),
        (0.01, 0.223610346),
        (0.01, 0.226787771),
        (0.01, 0.229965508),
        (0.01, 0.233143548),
        (0.01, 0.236321884),
        (0.01, 0.239500507),
        (0.01, 0.24267941),
        (0.01, 0.245858586),
        (0.01, 0.249038028),
        (0.01, 0.252217729),
        (0.01, 0.255397682),
        (0.01, 0.258577882),
        (0.01, 0.261758323),
        (0.01, 0.264938999),
        (0.01, 0.268119903),
        (0.01, 0.271301032),
        (0.01, 0.274482379),
        (0.01, 0.27766394),
        (0.01, 0.28084571),
        (0.01, 0.284027684),
        (0.01, 0.287209858),
        (0.01, 0.290392228),
        (0.01, 0.293574788),
        (0.01, 0.296757535),
        (0.01, 0.299940466),
        (0.01, 0.303123575),
        (0.01, 0.306306861),
        (0.01, 0.309490318),
        (0.01, 0.312673943),
        (0.01, 0.315857734),
        (0.01, 0.319041686),
        (0.01, 0.322225797),
        (0.01, 0.325410063),
        (0.01, 0.328594482),
        (0.01, 0.331779051),
        (0.01, 0.334963766),
        (0.01, 0.338148625),
        (0.01, 0.341333625),
        (0.01, 0.344518764),
        (0.01, 0.347704039),
        (0.01, 0.350889448),
        (0.01, 0.354074988),
        (0.01, 0.357260657),
        (0.01, 0.360446453),
        (0.01, 0.363632373),
        (0.01, 0.366818415),
        (0.01, 0.370004578),
        (0.01, 0.373190859),
        (0.01, 0.376377256),
        (0.01, 0.379563767),
        (0.01, 0.38275039),
        (0.01, 0.385937124),
        (0.01, 0.389123966),
        (0.01, 0.392310916),
        (0.01, 0.39549797),
        (0.01, 0.398685128),
        (0.01, 0.401872388),
        (0.01, 0.405059748),
        (0.01, 0.408247207),
        (0.01, 0.411434763),
        (0.01, 0.414622414),
        (0.01, 0.41781016),
        (0.01, 0.420997999),
        (0.01, 0.424185929),
        (0.01, 0.427373949),
        (0.01, 0.430562058),
        (0.01, 0.433750254),
        (0.01, 0.436938536),
        (0.01, 0.440126903),
        (0.01, 0.443315354),
        (0.01, 0.446503887),
        (0.01, 0.449692502),
        (0.01, 0.452881197),
        (0.01, 0.45606997),
        (0.01, 0.459258822),
        (0.01, 0.462447751),
        (0.01, 0.465636755),
        (0.01, 0.468825834),
        (0.01, 0.472014987),
        (0.01, 0.475204213),
        (0.01, 0.478393511),
        (0.01, 0.481582879),
        (0.01, 0.484772318),
        (0.01, 0.487961825),
        (0.01, 0.491151401),
        (0.01, 0.494341044),
        (0.01, 0.497530753),
        (0.01, 0.500720528),
        (0.01, 0.503910367),
        (0.01, 0.507100271),
        (0.01, 0.510290238),
        (0.01, 0.513480266),
        (0.01, 0.516670357),
        (0.01, 0.519860508),
        (0.01, 0.52305072),
        (0.01, 0.52624099),
        (0.01, 0.52943132),
        (0.01, 0.532621707),
        (0.01, 0.535812151),
        (0.01, 0.539002652),
        (0.01, 0.542193209),
        (0.01, 0.545383822),
        (0.01, 0.548574488),
        (0.01, 0.551765209),
        (0.01, 0.554955983),
        (0.01, 0.55814681),
        (0.01, 0.561337689),
        (0.01, 0.56452862),
        (0.01, 0.567719601),
        (0.01, 0.570910633),
        (0.01, 0.574101715),
        (0.01, 0.577292846),
        (0.01, 0.580484026),
        (0.01, 0.583675254),
        (0.01, 0.58686653),
        (0.01, 0.590057853),
        (0.01, 0.593249222),
        (0.01, 0.596440638),
        (0.01, 0.5996321),
        (0.01, 0.602823606),
        (0.01, 0.606015158),
        (0.01, 0.609206753),
        (0.01, 0.612398393),
        (0.01, 0.615590076),
        (0.01, 0.618781802),
        (0.01, 0.62197357),
        (0.01, 0.62516538),
        (0.01, 0.628357232),
        (0.01, 0.631549125),
        (0.01, 0.634741059),
        (0.01, 0.637933033),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.64),
        (0.01, 0.637268134),
        (0.01, 0.634060059),
        (0.01, 0.630851943),
        (0.01, 0.627643786),
        (0.01, 0.624435586),
        (0.01, 0.621227345),
        (0.01, 0.61801906),
        (0.01, 0.614810732),
        (0.01, 0.611602361),
        (0.01, 0.608393945),
        (0.01, 0.605185485),
        (0.01, 0.60197698),
        (0.01, 0.598768429),
        (0.01, 0.595559832),
        (0.01, 0.592351189),
        (0.01, 0.589142498),
        (0.01, 0.58593376),
        (0.01, 0.582724974),
        (0.01, 0.579516139),
        (0.01, 0.576307255),
        (0.01, 0.573098321),
        (0.01, 0.569889337),
        (0.01, 0.566680302),
        (0.01, 0.563471216),
        (0.01, 0.560262077),
        (0.01, 0.557052886),
        (0.01, 0.553843641),
        (0.01, 0.550634343),
        (0.01, 0.54742499),
        (0.01, 0.544215582),
        (0.01, 0.541006119),
        (0.01, 0.537796598),
        (0.01, 0.534587021),
        (0.01, 0.531377386),
        (0.01, 0.528167692),
        (0.01, 0.524957939),
        (0.01, 0.521748126),
        (0.01, 0.518538252),
        (0.01, 0.515328317),
        (0.01, 0.512118319),
        (0.01, 0.508908258),
        (0.01, 0.505698134),
        (0.01, 0.502487945),
        (0.01, 0.49927769),
        (0.01, 0.496067369),
        (0.01, 0.492856981),
        (0.01, 0.489646524),
        (0.01, 0.486435999),
        (0.01, 0.483225403),
        (0.01, 0.480014737),
        (0.01, 0.476803999),
        (0.01, 0.473593188),
        (0.01, 0.470382304),
        (0.01, 0.467171344),
        (0.01, 0.463960309),
        (0.01, 0.460749197),
        (0.01, 0.457538007),
        (0.01, 0.454326737),
        (0.01, 0.451115388),
        (0.01, 0.447903957),
        (0.01, 0.444692444),
        (0.01, 0.441480846),
        (0.01, 0.438269164),
        (0.01, 0.435057396),
        (0.01, 0.43184554),
        (0.01, 0.428633595),
        (0.01, 0.42542156),
        (0.01, 0.422209434),
        (0.01, 0.418997214),
        (0.01, 0.4157849),
        (0.01, 0.41257249),
        (0.01, 0.409359983),
        (0.01, 0.406147377),
        (0.01, 0.402934671),
        (0.01, 0.399721862),
        (0.01, 0.39650895),
        (0.01, 0.393295932),
        (0.01, 0.390082806),
        (0.01, 0.386869572),
        (0.01, 0.383656227),
        (0.01, 0.380442769),
        (0.01, 0.377229197),
        (0.01, 0.374015508),
        (0.01, 0.3708017),
        (0.01, 0.367587772),
        (0.01, 0.364373721),
        (0.01, 0.361159544),
        (0.01, 0.357945241),
        (0.01, 0.354730808),
        (0.01, 0.351516242),
        (0.01, 0.348301543),
        (0.01, 0.345086706),
        (0.01, 0.34187173),
        (0.01, 0.338656612),
        (0.01, 0.335441349),
        (0.01, 0.332225938),
        (0.01, 0.329010377),
        (0.01, 0.325794662),
        (0.01, 0.32257879),
        (0.01, 0.319362758),
        (0.01, 0.316146564),
        (0.01, 0.312930203),
        (0.01, 0.309713672),
        (0.01, 0.306496967),
        (0.01, 0.303280086),
        (0.01, 0.300063023),
        (0.01, 0.296845776),
        (0.01, 0.293628339),
        (0.01, 0.290410709),
        (0.01, 0.287192882),
        (0.01, 0.283974853),
        (0.01, 0.280756617),
        (0.01, 0.27753817),
        (0.01, 0.274319506),
        (0.01, 0.271100621),
        (0.01, 0.267881509),
        (0.01, 0.264662164),
        (0.01, 0.261442581),
        (0.01, 0.258222754),
        (0.01, 0.255002676),
        (0.01, 0.251782342),
        (0.01, 0.248561745),
        (0.01, 0.245340877),
        (0.01, 0.242119731),
        (0.01, 0.2388983),
        (0.01, 0.235676576),
        (0.01, 0.232454552),
        (0.01, 0.229232217),
        (0.01, 0.226009565),
        (0.01, 0.222786584),
        (0.01, 0.219563266),
        (0.01, 0.216339601),
        (0.01, 0.213115578),
        (0.01, 0.209891186),
        (0.01, 0.206666413),
        (0.01, 0.203441248),
        (0.01, 0.200215677),
        (0.01, 0.196989687),
        (0.01, 0.193763265),
        (0.01, 0.190536396),
        (0.01, 0.187309063),
        (0.01, 0.184081251),
        (0.01, 0.180852943),
        (0.01, 0.177624121),
        (0.01, 0.174394764),
        (0.01, 0.171164854),
        (0.01, 0.167934369),
        (0.01, 0.164703286),
        (0.01, 0.161471581),
        (0.01, 0.158239228),
        (0.01, 0.1550062),
        (0.01, 0.151772469),
        (0.01, 0.148538004),
        (0.01, 0.145302772),
        (0.01, 0.142066737),
        (0.01, 0.138829862),
        (0.01, 0.135592107),
        (0.01, 0.132353428),
        (0.01, 0.129113779),
        (0.01, 0.12587311),
        (0.01, 0.122631366),
        (0.01, 0.119388489),
        (0.01, 0.116144414),
        (0.01, 0.112899073),
        (0.01, 0.10965239),
        (0.01, 0.106404282),
        (0.01, 0.10315466),
        (0.01, 0.099903424),
        (0.01, 0.096650464),
        (0.01, 0.093395659),
        (0.01, 0.090138876),
        (0.01, 0.086879964),
        (0.01, 0.083618756),
        (0.01, 0.080355064),
        (0.01, 0.077088676),
        (0.01, 0.07381935),
        (0.01, 0.070546811),
        (0.01, 0.067270744),
        (0.01, 0.063990782),
        (0.01, 0.0607065),
        (0.01, 0.057417398),
        (0.01, 0.054122881),
        (0.01, 0.050822237),
        (0.01, 0.047514603),
        (0.01, 0.044198914),
        (0.01, 0.040873842),
        (0.01, 0.037537693),
        (0.01, 0.034188261),
        (0.01, 0.030822594),
        (0.01, 0.027436612),
        (0.01, 0.024024433),
        (0.01, 0.020577099),
        (0.01, 0.017079917),
        (0.01, 0.013506002),
        (0.01, 0.009796616),
        (0.01, 0.005768478),
        (0.01, 0),
        (0.01, 0),
    ]

    async with websockets.connect(DRIVE_URI) as websocket:
        for duration, speed in duration_speed:
            if not running:
                print("Cancel test")
                break
            await websocket.send(
                struct.pack(
                    "<dd",
                    map_value_to_range(speed, 0, 27, 0.53, 1.0) if pwm else speed,
                    0,
                )
            )
            sleep(duration)
        await websocket.send(struct.pack("<dd", 0, 0))


async def move(position, pose):
    async with websockets.connect(MOVE_URI) as websocket:
        await websocket.send(struct.pack("<dd", position, pose))


async def angular(speed):
    async with websockets.connect(DRIVE_URI) as websocket:
        await websocket.send(struct.pack("<dd", 0, speed))


async def angular_test():
    global running

    duration_speed = [
        (0.3, 2.5),
        (0.3, 4),
        (0.3, 5),
        (0.3, 6),
        (0.3, 7),
        (0.3, 7.5),
        (0.3, 8),
        (0.3, 8.5),
        (0.3, 9),
        (0.1, 9.5),
        (0.1, 8.5),
        (0.1, 8),
        (0.1, 7.5),
        (0.1, 7),
        (0.1, 6),
        (0.1, 5),
        (0.1, 4),
        (0.1, 2.5),
    ]

    async with websockets.connect(DRIVE_URI) as websocket:
        for duration, speed in duration_speed:
            if not running:
                print("Cancel test")
                break
            await websocket.send(struct.pack("<dd", 0, speed))
            sleep(duration)
        await websocket.send(struct.pack("<dd", 0, 0))


async def arc():
    def generate_arc_trajectory(
        R=1.0,  # radius of arc (meters)
        arc_angle=np.pi,  # 180 degrees = pi radians
        v_max=0.50,  # max forward speed (m/s)
        a_max=0.50,  # max linear accel (m/s^2)
        dt=0.01,  # timestep (s)
    ):
        """
        Generates a smooth trapezoidal-profile trajectory for a constant-radius arc.
        Returns arrays t[], v[], w[] (times, linear speeds, angular speeds).
        """

        # Compute total arc length
        L = abs(arc_angle) * R

        # Time required to accelerate to v_max
        t_accel = v_max / a_max
        d_accel = 0.5 * a_max * t_accel**2

        # Check if we reach max velocity before needing to decelerate
        if 2 * d_accel >= L:
            # It's a triangular profile (never reaches v_max)
            v_peak = np.sqrt(a_max * L)
            t_accel = v_peak / a_max
            t_flat = 0.0
        else:
            # Full trapezoid
            d_flat = L - 2 * d_accel
            t_flat = d_flat / v_max

        t_total = 2 * t_accel + t_flat

        # Time vector
        t = np.arange(0, t_total + dt, dt)

        v = np.zeros_like(t)
        w = np.zeros_like(t)

        for i, ti in enumerate(t):
            # Acceleration phase
            if ti < t_accel:
                v[i] = a_max * ti

            # Constant velocity phase
            elif ti < (t_accel + t_flat):
                v[i] = v_max

            # Deceleration phase
            else:
                t_dec = ti - (t_accel + t_flat)
                v[i] = v_max - a_max * t_dec
                if v[i] < 0:
                    v[i] = 0

            # Angular velocity from curvature: Ï‰ = v / R
            w[i] = v[i] / R
            if arc_angle < 0:  # turning right instead of left
                w[i] *= -1

        return t, v, w

    t, v, w = generate_arc_trajectory(
        R=0.5, arc_angle=0.87*np.pi, v_max=0.64, a_max=0.32, dt=0.01
    )
    async with websockets.connect(DRIVE_URI) as websocket:
        for i, _ in enumerate(t):
            await websocket.send(struct.pack("<dd", v[i], w[i]))
            sleep(0.01)


def signal_handler(signum, frame):
    global running
    running = False


signal.signal(signal.SIGINT, signal_handler)
while running:
    s = input("Enter command: ")

    if "q" == s:
        break
    elif "a" == s:
        asyncio.run(arm())
    elif "d" == s:
        asyncio.run(disarm())
    elif "s" == s:
        asyncio.run(drive(float(input("Speed: "))))
    elif "f" == s:
        asyncio.run(frequency_response())
    elif "t" == s:
        asyncio.run(test(bool(input("PWM (y/[n]): ") == "y")))
    elif "m" == s:
        asyncio.run(move(float(input("Position: ")), float(input("Pose: "))))
    elif "w" == s:
        asyncio.run(angular(float(input("Angular speed: "))))
    elif "y" == s:
        asyncio.run(angular_test())
    elif "c" == s:
        asyncio.run(arc())
asyncio.run(disarm())
